<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NAC Internal Auditor AI</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 min-h-screen p-6 font-sans">

<div class="max-w-5xl mx-auto">
  <header class="flex items-center justify-between mb-6">
    <h1 class="text-2xl font-bold">NAC Internal Auditor AI</h1>
    <div class="text-sm text-slate-600">Internal Auditor AI â€” MVP</div>
  </header>

  <main class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Left: Input -->
    <section class="bg-white p-4 rounded-lg shadow-sm">
      <h2 class="font-semibold mb-2">Paste CSV Data</h2>
      <textarea id="csvInput" rows="10" class="w-full p-2 border rounded mb-2" placeholder="Paste CSV here"></textarea>
      <button id="runAudit" class="w-full py-2 bg-emerald-600 text-white rounded shadow">Run Audit</button>
      <button id="pasteSample" class="w-full mt-2 py-2 border rounded">Paste Sample CSV</button>
    </section>

    <!-- Right: Results -->
    <section class="bg-white p-4 rounded-lg shadow-sm">
      <h2 class="font-semibold mb-2">Audit Results</h2>
      <div id="results" class="text-sm text-slate-600">No report yet.</div>
    </section>
  </main>
</div>

<script>
// ======= CSV Parser =======
function parseCSV(text) {
  const lines = text.split(/\r?\n/).filter(l => l.trim());
  if (!lines.length) return [];
  const headers = lines[0].split(",").map(h => h.trim());
  const data = lines.slice(1).map(line => {
    const parts = line.split(",").map(p => p.trim());
    const obj = {};
    headers.forEach((h, i) => obj[h] = parts[i] || "");
    return obj;
  });
  return { headers, data };
}

// ======= Audit Logic =======
function runAudit(parsed) {
  const dataRows = parsed.data;
  const findings = [];
  const keys = parsed.headers.map(h => h.toLowerCase());

  // check for date, amount, invoice columns
  if (!keys.some(k => k.includes("date"))) findings.push("No date column found.");
  if (!keys.some(k => k.includes("amount") || k.includes("total") || k.includes("value"))) findings.push("No amount column found.");
  if (!keys.some(k => k.includes("receipt") || k.includes("invoice"))) findings.push("No invoice/receipt column found.");

  // check duplicate invoices
  const invoiceKey = parsed.headers.find(h => h.toLowerCase().includes("invoice") || h.toLowerCase().includes("receipt"));
  if (invoiceKey) {
    const seen = {};
    const dups = [];
    dataRows.forEach(r => {
      const v = r[invoiceKey].trim();
      if (!v) return;
      if (seen[v]) dups.push(v);
      seen[v] = true;
    });
    if (dups.length) findings.push(`${dups.length} duplicate invoices found: ${dups.join(", ")}`);
  }

  return findings.length ? findings : ["No issues detected"];
}

// ======= DOM =======
document.getElementById("runAudit").addEventListener("click", () => {
  const csvText = document.getElementById("csvInput").value;
  if (!csvText) return alert("Paste CSV first.");
  const parsed = parseCSV(csvText);
  const results = runAudit(parsed);
  document.getElementById("results").innerHTML = results.map(r => `<div class="p-2 border-b">${r}</div>`).join("");
});

// Sample CSV
document.getElementById("pasteSample").addEventListener("click", () => {
  document.getElementById("csvInput").value = 
`date,employee,amount,invoice,requested_by,approved_by
2025-10-01,John Doe,120.00,INV-1001,John Doe,Alice
2025-10-05,Jane Smith,45.50,INV-1002,Jane Smith,Bob
2025-10-07,Mary Tan,5000,INV-1003,Mary Tan,Mary Tan`;
});
</script>

</body>
</html>
